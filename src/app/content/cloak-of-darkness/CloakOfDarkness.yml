---
name: Cloak of Darkness
version: 0.9
authors: "Adapted by [Matt Eland](http://www.matteland.com), Original story by [Roger Firth](http://www.firthworks.com/roger/)."
description:
  |
  A short demo based on [Roger Firth's specification](http://www.firthworks.com/roger/cloak/) to
  compare various Interactive Fiction development languages.
maxScore: 2
icon: fa-bookmark-o
introText:
- |
  Hurrying through the rainswept November night, you're glad to see the bright lights of the Opera
  House. It's surprising that there aren't more people about but, hey, what **do** you expect in a
  cheap demo game...?
# IDs are important here for YAML to have accurate anchors since they must be declared above refs
ids:
- &aPlayer yourself
- &rFoyer foyer
- &rBar bar
- &rCloakroom cloakroom
- &iCloak cloak
- &oMessage message
- &oHook hook
rooms:
# Foyer
- key: *rFoyer
  name: Foyer of the Opera House
  verbs:
    look:
    - |
      You are standing in a spacious hall, splendidly decorated in red and gold, with glittering
      chandeliers overhead. The entrance from the street is to the north, and there are doorways
      south and west.
  nav:
    north:
      goMessage: You've only just arrived, and besides, the weather outside seems to be getting worse.
    west: *rCloakroom
    south: *rBar
# Cloakroom
- key: *rCloakroom
  name: Cloakroom
  verbs:
    look:
    - |
      The walls of this small room were clearly once lined with hooks, though now only one remains.
      The exit is a door to the east.
  nav:
    east: *rFoyer
  contents:
  # The hook for hanging the cloak
  - key: *oHook
    name: small brass hook
    aliases:
      nouns:
      - Peg
    verbs:
      look: It's just a small brass hook with a {{contents}} hanging on it.
      # TODO: I really don't know how to do this here. Seems like this is a case for inline scripting logic.
      lookEmpty: It's just a small brass hook screwed to the wall.
    attributes:
      allowHang: true
      maxContents: 1
# Bar
- key: *rBar
  name: Foyer Bar
  verbs:
    look:
    - |
      The bar, much rougher than you'd have guessed after the opulence of the foyer to the north, is
      completely empty. There seems to be some sort of message scrawled in the sawdust on the floor.
  nav:
    north:
      room: *rFoyer
  attributes:
    isDark: true # This is updated onBarEnter based on presence / absence of the cloak
    darkName: Darkness
    darkDescription: It is pitch dark, and you can't see a thing.
  events:
    onAction:
    - invoke: onBarAction # Track blunders
    onEnter:
    - invoke: onBarEnter # Update whether or not we're dark
  contents:
  # Scrawled Message
  - key: *oMessage
    name: scrawled message
    attributes:
      describeWithRoom: false
    aliases:
      nouns:
      - Writing
      - Sawdust
      - Words
      - Word
      - Note
      - Floor
      - Ground
      adjectives:
      - Written
      - Dusty
    verbs:
      look:
      - invoke: onReadMessage # This will trigger the game end.
actors:
# The player
- key: *aPlayer
  name: yourself
  startRoom: *rFoyer
  isPlayer: true
  verbs:
    look: You look yourself over and seem to be in roughly the same shape you were in the last time you checked.
    examine:
      - |
        Taking some time, you look yourself over, finding the same old scars and blemishes you've accrued
        over the years. You don't love everything about your body, but it's yours and you're used to it.
  contents:
  # The Titular Cloak of Darkness
  - key: *iCloak
    name: black velvet cloak
    verbs:
      look:
        - A handsome cloak, of velvet trimmed with satin, and slightly spattered with raindrops.
          Its blackness is so deep that it almost seems to suck light from the room.
      examine:
        - The velvet cloak almost seems to have darkness woven into its very fabric. Everything about
          it is darker than it should be.
    inRoomDescription: A dark black velvet cloak rests in a heap on the floor.
    attributes:
      isWearable: true
      isWorn: true
    events:
      previewDrop: # Don't allow the user to drop the cloak if they're not in the cloakroom
      - invoke: previewCloakDrop
# Resource Strings used by different operations
strings:
- barBlunder: Blundering around in the dark isn't a good idea!
- cloakDropFail: This isn't the best place to leave a smart cloak lying around.
- messageWin: The message, neatly marked in the sawdust, reads...
- messageLose: The message has been carelessly trampled, making it difficult to read. You can just distinguish the words...
